define(["zepto","app/utils","underscore"],function(c,a,b){return{increase:function(g,f,e,h,d){c.ajax({url:window.ctx+"shoppingCart/increase",data:{itemId:g,quantity:f,type:e,startTime:d},loadMask:false,type:"POST",dataType:"json",async:false,success:function(i){typeof h=="function"&&h(i);
}});},decrease:function(f,e,d,g){c.ajax({url:window.ctx+"shoppingCart/decrease",data:{itemId:f,quantity:e,type:d},loadMask:false,async:false,type:"POST",dataType:"json",success:function(h){typeof g=="function"&&g(h);
}});},remove:function(e,d){c.ajax({url:window.ctx+"shoppingCart/delete",data:{id:e},loadMask:false,async:false,type:"POST",dataType:"json",success:function(f){typeof d=="function"&&d(f);
}});},addCart:function(h,i){var e=a.storage.get("shoppingCart")||"[]";var d=JSON.parse(e);var g=false;b.each(d,function(j){if(j.id==h.id){j.quantity=parseInt(j.quantity)+1;
g=true;return;}});if(!g){d.push(h);}var f=this.getCartGoodsNum(d);a.storage.set("shoppingCartNum",f);a.storage.set("shoppingCart",JSON.stringify(d));if(i){i(f);
}else{this.showCartPoint();}},removeCart:function(i,h){var e=a.storage.get("shoppingCart")||"[]";var g=JSON.parse(e);var d=[];d=b.filter(g,function(j){if(parseInt(j.id)==parseInt(i)){j.quantity=j.quantity>=1?j.quantity-1:0;
return j.quantity>0;}else{return true;}});var f=this.getCartGoodsNum(d);a.storage.set("shoppingCartNum",f);a.storage.set("shoppingCart",JSON.stringify(d));
if(h){h(f);}else{this.showCartPoint();}},clearCart:function(){a.storage.set("shoppingCartNum",0);a.storage.set("shoppingCart","[]");},getCarts:function(){var d=a.storage.get("shoppingCart");
return JSON.parse(d);},getCartGoodsNum:function(d){var e=0;b.each(d,function(f){e+=f.quantity;});return e;},showCartPoint:function(){var d=a.storage.get("shoppingCartNum");
if(d&&d>0){c(".he-footer .point").show().text(d);}else{c(".he-footer .point").hide();}}};});