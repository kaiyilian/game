define(["zepto","underscore","app/utils"],function(g,e,d){var b=g("#btn-code");var f=g("#mobile");var a=g("#captcha");var c=g("#btn-login");g(function(){var h={init:function(){this.initRadioAnimate();
b.on("tap",h.sendCaptchaCode);},verifyMobile:function(i){if(i==""){g.Dialog.info("请输入手机号码");return false;}if(!g.isPhone(i)){g.Dialog.info("您输入的手机号码格式不正确");
return false;}return true;},verifyCaptcha:function(i){if(i==""){g.Dialog.info("请输入验证码");return false;}if(!/^\d{4}$/.test(i)){g.Dialog.info("验证码必须为4位数字");
return false;}return true;},verifyProtocol:function(){if(!g(".choose-button-wrap i").hasClass("ok")){g.Dialog.info("您未勾选服务协议");return false;}return true;
},sendCaptchaCode:function(){var j=b;var i=f.val();if(!h.verifyMobile(i)){return;}g.ajax({url:window.ctx+"login/sendCode",type:"POST",data:{mobile:i},dataType:"json",beforeSend:function(){j.addClass("disabled");
},success:function(k){g.Dialog.success("发送成功");h.countDown();}});},login:function(){var j=f.val();var i=a.val();var k=c;if(!h.verifyMobile(j)){return;}if(!h.verifyCaptcha(i)){return;
}if(!h.verifyProtocol()){return;}g.ajax({url:window.ctx+"/login/verify",type:"POST",dataType:"json",data:{mobile:j,verification:i},beforeSend:function(){k.val("登陆中...").addClass("disable");
},success:function(l){k.val("登陆成功");location.href=g("#redirect").val();},onError:function(){k.val("登 陆").removeClass("disable");}});},countDown:function(){var j=b;
var k=60;j.off("tap");var i=window.setInterval(function(){--k;if(k<=0){j.text("获取验证码").removeClass("disabled").on("tap",h.sendCaptchaCode);return window.clearInterval(i);
}j.text(k+"秒");},1000);},initRadioAnimate:function(){g(".choose-button-wrap #radio").on("tap",function(){var i=g(this).find("i");if(i.hasClass("ok")){i.removeClass("ok");
c.addClass("disable").off("tap");}else{i.addClass("ok");c.removeClass("disable").on("tap",h.login);}});}};h.init();});});