<!DOCTYPE html>
<html lang="en">
<head>
		<meta charset="UTF-8">
		<meta name="format-detection" content="telephone=no"/>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no"/>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

		<meta name="keywords" content="">
		<meta name="description" content="">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="renderer" content="webkit">
		<title>抽奖</title>

		<script src="../../plugins/frozenui-1.3.0/lib/zepto.min.js"></script>
		<!--frozenUI-->
		<link href="../../plugins/frozenui-1.3.0/css/frozen.css" rel="stylesheet">
		<script src="../../plugins/frozenui-1.3.0/js/frozen.js"></script>
		<!--公共css-->
		<link href="../../css/common.css" rel="stylesheet">
		<link href="../../css/font.css" rel="stylesheet">
		<link href="../../css/background.css" rel="stylesheet">


		<link href="../../css/game/csg1.css" rel="stylesheet">

		<!--<script src="../../js/timeInit.js"></script>-->
</head>
<body>


<section class="ui-container ui-content">

		<section class="mxep_block bg_fd7a44" style="height:calc(100%);">

				<div class="ui-position-relative ui-txt-white" style="padding:50px 0 20px;">

						<div class="icon_line">
								<i class="ui-icon-return" onclick="history.back();"></i>
								<div class="ui-txt-center txt">猜水果</div>
								<i class="ui-icon-share"></i>
						</div>

						<div class="integral_container">
								<span>当前积分：</span>
								<span class="user_integral">100000</span>
						</div>

						<div id="lottery">

								<div class="row">

										<span class="lottery-unit lottery-unit-0" data-img="watermelon">
												<img src="../../image/game/csg/watermelon.png">
										</span>

										<span class="lottery-unit lottery-unit-1" data-img="cherry">
												<img src="../../image/game/csg/cherry.png">
										</span>

										<span class="lottery-unit lottery-unit-2" data-img="apple">
												<img src="../../image/game/csg/apple.png">
										</span>

										<span class="lottery-unit lottery-unit-3" data-img="lemon">
												<img src="../../image/game/csg/lemon.png">
										</span>

										<span class="lottery-unit lottery-unit-4" data-img="cherry">
												<img src="../../image/game/csg/cherry.png">
										</span>

								</div>

								<div class="row">

										<span class="lottery-unit lottery-unit-15" data-img="apple">
												<img src="../../image/game/csg/apple.png">
										</span>

										<span class="lottery-unit lottery-unit-5" data-img="apple">
												<img src="../../image/game/csg/apple.png">
										</span>

								</div>

								<div class="row">

										<span class="lottery-unit lottery-unit-14" data-img="cherry">
												<img src="../../image/game/csg/cherry.png">
										</span>

										<span class="lottery-unit lottery-unit-6" data-img="lemon">
												<img src="../../image/game/csg/lemon.png">
										</span>

								</div>

								<div class="row">

										<span class="lottery-unit lottery-unit-13" data-img="apple">
												<img src="../../image/game/csg/apple.png">
										</span>

										<span class="lottery-unit lottery-unit-7" data-img="cherry">
												<img src="../../image/game/csg/cherry.png">
										</span>

								</div>

								<div class="row">

										<span class="lottery-unit lottery-unit-12" data-img="lemon">
												<img src="../../image/game/csg/lemon.png">
										</span>

										<span class="lottery-unit lottery-unit-11" data-img="cherry">
												<img src="../../image/game/csg/cherry.png">
										</span>

										<span class="lottery-unit lottery-unit-10" data-img="banana">
												<img src="../../image/game/csg/banana.png">
										</span>

										<span class="lottery-unit lottery-unit-9" data-img="apple">
												<img src="../../image/game/csg/apple.png">
										</span>

										<span class="lottery-unit lottery-unit-8" data-img="watermelon">
												<img src="../../image/game/csg/watermelon.png">
										</span>

								</div>


								<a class="begin">开始</a>

						</div>

						<div class="ui-row" style="width:100%;height:6px;background-color: #d24d15;margin-bottom: 10px;"></div>

						<div class="ui-row row_1">

								<div class="ui-row ui-row-flex ui-txt-center ui-txt-line-height-30 choose_fruit">

										<div class="ui-col ui-col" data-img="watermelon">
												<div class="txt">翻2倍</div>
												<img src="../../image/game/csg/watermelon_item.png">
												<div class="item bet_money">0</div>
										</div>

										<div class="ui-col ui-col" data-img="cherry">
												<div class="txt">翻3倍</div>
												<img src="../../image/game/csg/cherry_item.png">
												<div class="item bet_money">0</div>
										</div>

										<div class="ui-col ui-col" data-img="apple">
												<div class="txt">翻5倍</div>
												<img src="../../image/game/csg/apple_item.png">
												<div class="item bet_money">0</div>
										</div>

										<div class="ui-col ui-col" data-img="lemon">
												<div class="txt">翻10倍</div>
												<img src="../../image/game/csg/lemon_item.png">
												<div class="item bet_money">0</div>
										</div>

										<div class="ui-col ui-col" data-img="banana">
												<div class="txt">翻50倍</div>
												<img src="../../image/game/csg/banana_item.png">
												<div class="item bet_money">0</div>
										</div>

								</div>

						</div>

						<div class="ui-row row_2 display-webkit-box ui-txt-center">

								<span style="width:60px;">下注：</span>
								<span class="bet_base">
										<input class="ui-input" placeholder="请选择或输入倍数" maxlength="6"
													 onkeyup="this.value=this.value.replace(/\D/g,'')">
								</span>

								<span class="multiples_container">
										<span>x</span>
										<span class="multiples">10</span>
										<span class="multiples_count">2</span>
								</span>

								<span class="choose_multiples">
										倍数
										<ul class="multiples_list">
												<li>2</li>
												<li>5</li>
												<li>10</li>
										</ul>
								</span>

						</div>

						<div class="ui-row-flex btn_list">

								<div class="ui-col ui-col">
										<div class="item btn_reset active">重置</div>
								</div>

								<div class="ui-col ui-col">
										<div class="item btn_push active">投入</div>
								</div>

						</div>

				</div>

		</section>

</section>


<script type="text/javascript">

		$(function () {

				// 选择 水果，准备 下注
				$(".row_1 .choose_fruit .ui-col").each(function (e) {

						$(this).tap(function () {

								$(".bet_base input").val("");//清空 投入积分 输入框
								$(this).addClass("active").siblings().removeClass("active");
								initChooseFruitImg();//初始化 选择水果 图片

						});

				});


				//“选择基础倍数 ul ”显示
				$(".choose_multiples").tap(function (e) {

						e.stopImmediatePropagation();

						$(".multiples_list").show();

				});

				//“选择基础倍数 ul ”隐藏
				$("body").tap(function () {
						$(".multiples_list").hide();
				});

				//选择 基础 倍数
				$(".multiples_list li").tap(function (e) {
						e.stopImmediatePropagation();

						var base = $(this).html();//基础倍数
						$(".multiples_container").find(".multiples").html(base);//赋值基础倍数
						$(".multiples_container").find(".multiples_count").html(0);//赋值基础倍数 数量为0

						$(".multiples_list").hide();//“选择基础倍数 ul ”隐藏


				});

				//增加 基础倍数的 count
				$(".multiples_container").tap(function () {

						var count = parseInt($(".multiples_container .multiples_count").html());
						if (count >= 10) {
								alert("最多 10 倍！")
						}
						else {
								count += 1;
								$(".multiples_container .multiples_count").html(count);
						}

				});

				//投入
				$(".btn_push").tap(function () {
						console.log("投入成功！");

						var val = $.trim($(".bet_base input").val());
						$(".choose_fruit").find(".active").find(".bet_money").html(val);
						$(".bet_base input").val("");

						$(".choose_fruit").find(".active").removeClass("active");
						initChooseFruitImg();

				});

				//重置
				$(".btn_reset").tap(function () {

						$(".bet_base input").val("");//基础金额 为空
						$(".multiples_container .multiples").html(2);
						$(".multiples_container .multiples_count").html(0);

						$(".choose_fruit").find(".active").removeClass("active");
						initChooseFruitImg();

				});
		});

		//初始化 选择水果 图片
		var initChooseFruitImg = function () {
				$(".row_1 .choose_fruit .ui-col").each(function () {

						var img_name = $(this).attr("data-img");
						var img_pure_url = "../../image/game/csg/" + img_name + "_item.png";
						var img_choose_url = "../../image/game/csg/" + img_name + "_choose.png";

						if ($(this).hasClass("active")) {
								$(this).find("img").attr("src", img_choose_url);
						}
						else {
								$(this).find("img").attr("src", img_pure_url);
						}

				});
		};

		var lottery = {
				index: -1,	//当前转动到哪个位置，起点位置
				count: 0,	//总共有多少个位置
				timer: 0,	//setTimeout的ID，用clearTimeout清除
				speed: 20,	//初始转动速度
				times: 0,	//转动次数
				cycle: 50,	//转动基本次数：即至少需要转动多少次再进入抽奖环节
				prize: -1,	//中奖位置

				init: function (id) {
						if ($("#" + id).find(".lottery-unit").length > 0) {
								var $lottery = $("#" + id),
												$units = $lottery.find(".lottery-unit");
								this.obj = $lottery;
								this.count = $units.length;
								$lottery.find(".lottery-unit-" + this.index).addClass("active");
						}
				},

				roll: function () {
						var index = this.index;
						var count = this.count;
						var lottery = this.obj;

//						console.log(index + "----" + count);

//						var $index = $(lottery).find(".lottery-unit-" + index);

						$(lottery).find(".lottery-unit-" + index).removeClass("active");
						var img_name = $(lottery).find(".lottery-unit-" + index).attr("data-img");
						var img_url = "../../image/game/csg/" + img_name + ".png";
						$(lottery).find(".lottery-unit-" + index).find("img").attr("src", img_url);

						index += 1;
						if (index > count - 1) {
								index = 0;
						}
						$(lottery).find(".lottery-unit-" + index).addClass("active");
						var img_name = $(lottery).find(".lottery-unit-" + index).attr("data-img");
						var img_url = "../../image/game/csg/" + img_name + "_prize.png";
						$(lottery).find(".lottery-unit-" + index).find("img").attr("src", img_url);
//						$index.find("img")

						this.index = index;
						return false;
				},
				stop: function (index) {
						this.prize = index;
//						alert(this.prize)
						return false;
				}
		};

		//转动 动画
		var roll = function () {
				lottery.times += 1;
				lottery.roll();

				//抽奖完成 初始化数据
				if (lottery.times > lottery.cycle + 10 && lottery.prize == lottery.index) {
						getPrizeInfo();//
						clearTimeout(lottery.timer);
						lottery.prize = -1;
						lottery.times = 0;
						click = false;
				}
				else {
						if (lottery.times < lottery.cycle) {
								lottery.speed -= 10;
						}
						else if (lottery.times == lottery.cycle) {		//转了cycle圈后确定 礼品
//								var index = Math.random() * (lottery.count) | 0;

								var index = 10;
								lottery.prize = index;
						}
						else {
								if (lottery.times > lottery.cycle + 10 &&
												((lottery.prize == 0 && lottery.index == 7) ||
												lottery.prize == lottery.index + 1)) {
										lottery.speed += 110;
								}
								else {
										lottery.speed += 20;
								}
						}
						if (lottery.speed < 40) {
								lottery.speed = 40;
						}

						console.log(lottery.times + '^^^^^^' + lottery.speed + '^^^^^^^' + lottery.prize);
						lottery.timer = setTimeout(roll, lottery.speed);
				}
				return false;

		};

		//获取奖品信息
		var getPrizeInfo = function () {

				var name = $("#lottery").find(".lottery-unit").eq(lottery.prize).html();
				console.log(lottery.prize);
				console.log(name);
		};

		var click = false;

		window.onload = function () {
				lottery.init('lottery');

				//点击开始
				$("#lottery a").click(function () {
						if (click) {
								return false;
						}
						else {
								lottery.speed = 100;
								roll();
								click = true;
								return false;
						}
				});
		};

</script>

</body>
</html>